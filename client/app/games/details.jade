include ../template/_mixins

.row.ng-cloak.row--fullheight.fade-animation(ng-controller="GameController", ng-show="!pageLoading")

	// right column
	.col-sm-3.col-sm-push-9.col--menu.text-center
		img.img--logo(ng-src="{{ game.media.logo.url }}")

		.ratingbox(rating-avg="$parent.game.rating", rating-votes="$parent.game.votes", ng-mouseenter="editing=true", ng-mouseleave="editing=false")
			.ratingbox__left-col
				.ratingbox__rating.rating-user(ng-show="editing") {{ hoverRating | rating }}
				.ratingbox__rating(ng-class="{ 'rating-hide' : editing }") {{ $parent.game.rating | rating }}
			.ratingbox__right-col
				rating.rating-user(ng-show="editing", ng-model="ratingUser", max="10", rating-states="states", on-hover="hoverRating = value", on-leave="hoverRating = ratingUser")
				rating.rating-avg(ng-hide="editing", ng-model="ratingAvg", max="10", rating-states="states", readonly="true")
				span.votes {{ $parent.game.votes | number }} vote{{ $parent.game.votes == 1 ? '' : 's' }}
		hr

		label.label--block(ng-show="game.game_type") {{ game.game_type | gametype }}
		label(ng-show="game.produced_units") {{ game.produced_units | number }} units produced
		hr(ng-show="game.game_type || game.units")

		label.label-name.label--block(ng-show="game.designers") Game Design
		label.label-value(ng-show="game.designers") {{ game.designers.join(', ') }}
		hr(ng-show="game.designers")

		label.label-name.label--block(ng-show="game.artists") Art Design
		label.label-value(ng-show="game.artists")  {{ game.artists.join(', ') }}
		hr(ng-show="game.artists")

		label.label-name(ng-show="game.ipdb")
			a.a--lighter(href="http://www.ipdb.org/machine.cgi?id={{ game.ipdb.number  }}", target="_blank")
				span.space-right
					strong IPDB
				+icon('external-link').shift-up
		dl.dl--oneliner(ng-show="game.ipdb.rating")
			dt Rating
			dd(title="{{ game.ipdb.votes | number }} vote{{ game.ipdb.votes == 1 ? '' : 's' }}")
				strong {{ game.ipdb.rating }}
			dt(ng-show="game.ipdb.top300") Top 300
			dd(ng-show="game.ipdb.top300") rank <strong>{{ game.ipdb.top300 }}</strong>

		hr(ng-show="game.ipdb")

		button.btn.btn-default.btn-block.padder-bottom
			+icon('star').space-right
			| Follow
		a.btn.btn-primary.btn-block.padder-bottom(ui-sref="addRelease({ id: game.id })", ng-show="auth.hasPermission('releases/add')")
			+icon('plus-circle').space-right
			| Add Release

	// left column (main content)
	.col-sm-9.col-sm-pull-3.col--main
		h1.h--primary {{ game.title }}
		h1.h--small.pull-right {{ game.manufacturer }} &middot; {{ game.year }}
		hr
		h1 Releases
		label(ng-hide="game.releases.length > 0") No releases for this game available.

		// each release
		.panel(ng-repeat="release in game.releases", ng-controller="ReleaseController")
			.col-sm-4.col-md-3
				carousel(interval="60000")
					slide(ng-repeat="slide in release.__portraitShots", active="slide.active")
						img(ng-src="{{ slide.url }}")

				button.btn.btn-primary.btn-block.padder-top-3x(ng-click="download(game, release)")
					+icon('download').space-right
					| Download

			.col-sm-8.col-md-9
				.inline-edit(ng-class='{ open: editing }')
					+icon('pencil-circle').a.icon-opener(ng-click="editing = true")
					+icon('check-circle').a.icon-editing(ng-click="editing = false")
					+icon('times-circle').a.icon-editing(ng-click="editing = false")
				h2.h--primary(ng-show="editing")
					.form-group.form--inline
						input.form-control.input-lg(type="text", value="{{ release.name }}")
				h2.h--primary(ng-hide="editing") {{ release.name }} <small>{{ release.__latestVersion.version }}</small>
				.badge.badge--tag.badge--small(ng-repeat="tag in release.tags", tooltip="{{tag.description}}") {{ tag.name }}

				span.clearfix.padder-top(ng-show="release.tags && release.tags.length") &nbsp;
				div.markdown(markdown="release.description", ng-show="release.description")
				h3.h--smaller.h--primary Authors
				.media(ng-repeat="author in release.authors")
					.media-left.media-middle
						img.img-avatar.img-avatar--sm(gravatar-src="author.user.gravatar_id", gravatar-default="404", fallback-icon="user")
					.media-body
						user {{ author.user.name }}
						br
						| {{ author.roles.join(', ') }}

				h3.h--smaller.h--primary(ng-show="release.acknowledgements") Acknowledgements
				div.markdown(markdown="release.acknowledgements", ng-show="release.acknowledgements")

				h3.h--smaller.h--primary Version History
				p(ng-repeat="version in release.versions") <strong>{{ version.version }}</strong>

				h3.h--smaller.h--primary(ng-show="release.links && release.links.length") Links
				a(ng-repeat="link in release.links", ng-href="link.url") {{ link.label }}

			.col-sm-12

				h1.h--small Available Flavors
				hr
				table.table.table-striped
					thead
						tr
							th
							th Orientation
							th Lightning
							th Compatibility
							th Version
							th Size
					tbody
						tr(ng-repeat="file in release.__latestVersion.files | filter:tableFile")
							td.td--img
								img.img--rounded(ng-src="{{ file.media.playfield_image.variations.square.url }}")
							td
								| {{ flavors.orientation.values[file.flavor.orientation].name }} <br>
								i {{ flavors.orientation.values[file.flavor.orientation].other }}
							td
								| {{ flavors.lightning.values[file.flavor.lightning].name }} <br>
								i {{ flavors.lightning.values[file.flavor.lightning].other }}
							td
								span(ng-repeat="compat in file.compatibility") {{ compat.label }}
							td {{ release.__latestVersion.version }}
							td {{ file.file.bytes | bytes }}



				h1.h--small Comments
				hr

				label(ng-show="!release.comments || release.comments.length == 0") No comments yet.
				.media.media--no-margin.collapse-in-animation(ng-repeat="comment in release.comments track by comment.id", ng-controller="CommentCtrl", ng-init="show=true")
					.collapse-in-animation-inner
						.media-left.avatar
							img.img-avatar.pull-left(gravatar-src="comment.from.gravatar_id", gravatar-default="404", fallback-icon="user")
						.media-body.media--full-width
							.panel.panel--inner
								.panel-triangle
								.panel-heading
									label
									strong {{ comment.from.name }}
									| &nbsp;commented&nbsp;
									span(am-time-ago="comment.created_at")
								.panel-body
									div.markdown(markdown="comment.message")

				h3.h--smaller.h--primary(ng-show="auth.isAuthenticated") Add a Comment:
				.media(ng-show="auth.isAuthenticated")
					.media-left.avatar
						img.img-avatar.pull-left(gravatar-src="auth.user.gravatar_id", gravatar-default="404", fallback-icon="user")
					.media-body.media--full-width
						tabset
							label.label--small.pull-right Comments are parsed with <a href="http://daringfireball.net/projects/markdown/syntax" target="_blank">Markdown</a>.
							tab
								tab-heading(title="Write")
									+icon('edit')
									.panel-triangle
								textarea.textarea--full.animate(placeholder="Your comment", msd-elastic, ng-model="$parent.$parent.newComment")
							tab
								tab-heading(title="Preview"): +icon('eye')
								div.markdown(markdown="$parent.$parent.newComment")
								label.tab__label(ng-show="!$parent.$parent.newComment || $parent.$parent.newComment.length == 0") Nothing to preview.

				button.btn.btn-default.padder-top.pull-right(ng-click="addComment(release.id)") Comment
				.clearfix
				p.padder-bottom
			.clearfix
			p.padder-bottom



		h1 ROMs
			button.btn.btn-primary.btn--round.pull-right(ng-click="romUploadCollapsed = !romUploadCollapsed")
				+icon('plus')(ng-show="romUploadCollapsed")
				+icon('angle-up').small(ng-show="!romUploadCollapsed")

		.full-width
			div(collapse="romUploadCollapsed")
				.well.well--full-width.well--dropzone(ng-file-drop="onRomUpload($files)", ng-multiple="true", drag-over-class="well--dragging")
					ul.list--files
						li.panel(ng-repeat="file in meta.romFiles")
							.col--list-files-left
								+icon('ext-rom').svg-4x
							.col--list-files-right
								.col-md-3(ng-show="!file.uploading")
									.block.text--large: strong {{ file.name }}
									.block.text--large {{ file.bytes | bytes }}
								.col-md-9(ng-show="!file.uploading")
									.row
										.col-xs-2
											label.control-label.small Version
										.col-xs-3
											label.control-label.small Language
										.col-xs-6
											label.control-label.small Notes
									.row
										.col-xs-2
											input.form-control(type="text", ng-model="newRoms[file.id].version")
										.col-xs-3
											select.form-control.form-control--solid(ng-model="newRoms[file.id].language", ng-options="opt as opt.label for opt in romLanguages")
										.col-xs-6
											input.form-control(type="text", ng-model="newRoms[file.id].notes", placeholder="Home Version? Profanity?")

								.col-md-12(ng-show="file.uploading")
									.block.text--large: strong {{ file.name }}
									progressbar.progress-striped.active(value="file.progress")
							+icon('trash')(ng-click="removeRom(file)")

					.pull-right.padder-top(ng-show="meta.romFiles.length > 0")
						button.btn.btn-default.space-right Clear
						button.btn.btn-primary(ng-click="saveRoms()")
							+icon('plus-circle').space-right
							| Add
					.clearfix(ng-show="meta.romFiles.length > 0")

					label.center-block.text-center: small: i Drop ROM .zip files in here.

		label(ng-hide="roms.length > 0") No ROMs available.
		table.table.table-striped(ng-show="roms.length > 0")
			thead
				tr
					th Name
					th Version
					th.hidden-xs Language
					th.hidden-xs Notes
					th DLs
					th Size
			tbody
				tr(ng-repeat="rom in roms")
					td: b {{ rom.id }}
					td {{ rom.version }}
					td.hidden-xs {{ rom.language }}
					td.hidden-xs {{ rom.notes }}
					td {{ rom.downloads | number }}
					td {{ rom.file.bytes | bytes }}

		h1 Backglasses
		label(ng-hide="game.backglasses.length > 0") No backglasses available.
		.row(ng-show="game.backglasses.length > 0")
			.col-md-4.col-sm-6.col-xs-12.fade-animation.padder-bottom-2x(ng-repeat="backglass in game.backglasses")
				.flipbox.flipbox-backglass
					.panel.panel--backglass.flipbox-front.text-center
						h1.h--smaller
							i.fa.fa-picture-o.space-right
							| Direct B2S
						hr
						.oneliner
							i.icon.icon-user
							| &nbsp;&nbsp; {{ backglass.author.user }}
						hr
						.backglass-description
							scrollable(always-visible="true")
								markdown.markdown(markdown="backglass.description")
						footer
							hr
							.third
								span
									i.fa.fa-arrow-circle-down.space-right
									| {{ backglass.downloads | number }}
							.third
								span
									i.fa.fa-star.space-right
									| {{ backglass.rating | rating }}
							.third
								span {{ backglass.download.size | bytes }}

					.panel.panel--backglass.flipbox-back.img.img-fullspan(img-bg="backglass.thumb")
						button.btn.btn-primary.btn-lg.btn--sticky-bottom(download="backglass.download", download-info="[ game, backglass ] | dlBackglass", ng-click="$event.stopPropagation()")
								| Download
					.clearfix


		h1 Media
			button(ng-show="game.media.length > 0").btn.btn-primary.pull-right
				i.fa.fa-download.space-right
				| Download Pack
		label(ng-hide="game.media.length > 0") No media available.
		.row(ng-show="game.media.length > 0")
			.col-md-4.col-sm-6.col-xs-12.fade-animation.padder-bottom-2x(ng-repeat="item in game.media")
				.flipbox.flipbox-backglass
					.panel.panel--backglass.flipbox-front.text-center
						h1.h--smaller
							i.fa.space-right(ng-class="{ 'fa-picture-o': item.format == 'image', 'fa-video-camera': item.format == 'video', 'fa-info-circle': item.type == 'instructioncard' }")
							| {{ item.type | mediatype }}
						hr
						.oneliner
							i.icon.icon-user
							| &nbsp;&nbsp; {{ item.author.user }}
						hr
						.oneliner(ng-show="item.width && item.height")
							| {{ item.width }} &times; {{ item.height }}
						hr(ng-show="item.width && item.height")

						.oneliner(ng-show="item.pages")
							| {{ item.pages.length }} pages
						hr(ng-show="item.pages")

						.oneliner(ng-show="item.duration")
							| {{ item.duration }} seconds
						hr(ng-show="item.duration")

						.morelines(ng-show="item.pages") {{ item.pages.join(', ') }}

						footer
							hr
							.third
								span
									i.fa.fa-arrow-circle-down.space-right
									| {{ item.downloads | number }}
							.third
								span
									i.fa.fa-star.space-right
									| {{ item.rating | rating }}
							.third
								span {{ item.download.size | bytes }}

					.panel.panel--backglass.flipbox-back.img.img--rounded(img-bg="item.thumb")
						button.btn.btn-primary.btn-lg.btn--sticky-bottom(download="item.download", download-info="[ game, item ] | dlMedia", ng-click="$event.stopPropagation()")
							| Download
					.clearfix


		h1 Alternative Media
		label(ng-hide="game.secondarymedia.length > 0") No alternative media available.

		p
			br

script(id="template/carousel/carousel.html", type="text/ng-template")
	.carousel(ng-mouseenter="pause()", ng-mouseleave="play()", ng-swipe-right="prev()", ng-swipe-left="next()")
		ol.carousel-indicators(ng-show="slides.length > 1")
			li(ng-repeat="slide in slides track by $index", ng-class="{active: isActive(slide)}", ng-click="select(slide)")
		.carousel-inner(ng-transclude="")
		a.left.carousel-control(ng-click="prev()", ng-show="slides.length > 1")
			+icon('angle-left')
		a.right.carousel-control(ng-click="next()", ng-show="slides.length > 1")
			+icon('angle-right')
