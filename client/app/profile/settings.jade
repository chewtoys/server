include ../template/_mixins


.row.row--fullheight(ng-controller="ProfileSettingsCtrl")

	// sidebar (left)
	.col-sm-3.col--menu
		h1 Profile
		hr

		.color-primary Settings
		span Stats

		p.padder-bottom-2x


	// content
	.col-sm-9.col--main

		p.padder-top-2x
		.media
			.media-left.media-middle
				img.img-avatar.img-avatar--xlg(gravatar-src="auth.user.gravatar_id", gravatar-default="404", fallback-icon="user")
			.media-body
				h3.h--large.h--shift-up {{ auth.user.name }}
				.text--large.text--shift-up {{ auth.user.email }}

		p.padder-top-3x
		.form-group(ng-class="{ error: errors.name }")
			label.col-sm-3.control-label Name
			.col-sm-7
				.input-group
					input.form-control(type="text", ng-model="updatedUser.name")
					span.input-group-addon(tooltip="Name is publicly visible.", tooltip-placement="right", tooltip-append-to-body="true")
						+icon('eye').small

			.clearfix
			div.alert.alert-danger(ng-show="errors.name")
				+icon('warning').shift-up.space-right
				| {{ errors.name }}

		.form-group(ng-class="{ error: errors.location }")
			label.col-sm-3.control-label Location
			.col-sm-7
				.input-group
					input.form-control(type="text", ng-model="updatedUser.location")
					span.input-group-addon(tooltip="Location is publicly visible.", tooltip-placement="right", tooltip-append-to-body="true")
						+icon('eye').small
			.clearfix
			div.alert.alert-danger(ng-show="errors.location")
				+icon('warning').shift-up.space-right
				| {{ errors.location }}

		.form-group(ng-class="{ error: errors.email }")
			label.col-sm-3.control-label Email
			.col-sm-7
				input.form-control(type="text", ng-model="updatedUser.email", ng-disabled="auth.user.email_status.code === 'pending_update'")
			.clearfix
			.col-sm-offset-3.col-sm-7(ng-show="auth.user.email_status.code === 'pending_update'")
				+icon('arrow-right').shift-up
				| Email update pending ({{ auth.user.email_status.value }}).
				a.pull-right(ng-click="abortEmailUpdate()")
					+icon('times').shift-up.space-right-less
					| Abort
				p.padder-bottom

			div.alert.alert-danger(ng-show="errors.email")
				p
					+icon('warning').shift-up.space-right
					| {{ errors.email }}

		.col-sm-offset-3.col-sm-7
			button.btn.btn-default.pull-right(ng-click="updateUserProfile()")
				+icon('check-circle').space-right
				| Save
		.clearfix

		//- LOCAL REGISTRATUION
		.span(ng-hide="auth.user.provider === 'local'")

			h1 Local Credentials
			hr

			p: i You havenâ€™t registered at VPDB yet, but you can add local credentials below, which allow you to login even if the third party provider is down or refuses your credentials.

			form.form-horizontal.padder-top-3x(role="form")

				.form-group(ng-class="{ error: errors.username }")
					label.col-sm-3.control-label Username
					.col-sm-7
						input.form-control(type="text", ng-model="localCredentials.username")
					.clearfix
					div.alert.alert-danger(ng-show="errors.username")
						+icon('warning').shift-up.space-right
						| {{ errors.email }}

				.form-group(ng-class="{ error: errors.password }")
					label.col-sm-3.control-label Password
					.col-sm-7
						input.form-control(type="password", ng-model="localCredentials.password1")
					.clearfix
					div.alert.alert-danger(ng-show="errors.password")
						+icon('warning').shift-up.space-right
						| {{ errors.password }}

				.form-group(ng-class="{ error: errors.password2 }")
					label.col-sm-3.control-label Confirm Password
					.col-sm-7
						input.form-control(type="password", ng-model="localCredentials.password2")
					.clearfix
					div.alert.alert-danger(ng-show="errors.password2")
						+icon('warning').shift-up.space-right
						| {{ errors.password2 }}

				.row
					.col-sm-offset-3.col-sm-7
						button.btn.btn-default.pull-right(ng-click="createLocalCredentials()")
							+icon('plus-circle').space-right
							| Create local credentials
				.clearfix


		//- CHANGE PASSWORD
		.span(ng-show="auth.user.provider === 'local'")

			h1 Change Password
			hr

			form.form-horizontal.padder-top-3x(role="form")

				.form-group(ng-class="{ error: errors.current_password }")
					label.col-sm-3.control-label Current Password
					.col-sm-7
						input.form-control(type="password", ng-model="localUser.currentPassword")
					.clearfix
					div.alert.alert-danger(ng-show="errors.current_password")
						+icon('warning').shift-up.space-right
						| {{ errors.current_password }}

				.form-group(ng-class="{ error: errors.password }")
					label.col-sm-3.control-label Password
					.col-sm-7
						input.form-control(type="password", ng-model="localUser.password1")
					.clearfix
					div.alert.alert-danger(ng-show="errors.password")
						+icon('warning').shift-up.space-right
						| {{ errors.password }}

				.form-group(ng-class="{ error: errors.password2 }")
					label.col-sm-3.control-label Confirm Password
					.col-sm-7
						input.form-control(type="password", ng-model="localUser.password2")
					.clearfix
					div.alert.alert-danger(ng-show="errors.password2")
						+icon('warning').shift-up.space-right
						| {{ errors.password2 }}

				.row
					.col-sm-offset-3.col-sm-7
						button.btn.btn-default.pull-right(ng-click="changePassword()")
							+icon('check-circle').space-right
							| Change
				.clearfix

		h1 Linked Accounts
		hr

		table.table.table-striped(ng-show="providers.length")
			thead
				tr
					th Provider
					th Username
					th User ID
					th Last logged
			tbody
				tr(ng-repeat="provider in providers")
					td.td--big-icon
						+icon('{{ provider.icon }}').space-right
						b {{ provider.name }}
					td {{ auth.user[provider.id].username }}
					td {{ auth.user[provider.id].id }}
					td -

		p(ng-hide="providers.length")
			i No linked accounts. Linked accounts appear when you choose to login with one of the supported third party
				| providers. In order to link a third party account to this account, simply login using a third party
				| account where you registered with the same email address.

		p.padder-bottom-2x