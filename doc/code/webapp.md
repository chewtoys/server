---
title: Web Application
template: page.jade
menuIndex: 1
subsectionIndex: 3
---

# Overview

The web application runs with AngularJS, which takes care of loading as well
as rendering dynamic content. It also handles routing and templating. This 
means that on server side, we deliver 100% statically compiled HTML and 
Javascript code and retrieve dynamic data exclusively via the API.


## Code Structure

Code in the web app is organized by feature. A feature is typically a page, 
but we also have a "commons" feature and a feature for the entire developer
site you're reading now.

In Angular terms, a feature corresponds to a [module][ngModule] and has its
own sub-folder within the `client/app` directory. Since templates and 
Javascript code are wired very closely together, we keep the templates in the
module folder as well.


## Templating

There is only one HTML file that isn't loaded dynamically, `index.html`. It 
gets rendered through [`client/app/index.jade`][index.jade] and is returned by 
the web server for any folder requests, i.e. requests that point to a 
directory rather than a file name.

All other views are so-called *partials* and are dynamically loaded and
inserted into the DOM by Angular's routing module. 


## Dependencies

We use [Bower][bower] for managing client-side dependencies. That means that 
generally, if you need a new dependency, all you have to do is:

	bower install <dependency> --save
	grunt build

And you're done (as in: dependency is downloaded, script is added to the DOM 
when developing and added to the global concatenated and minified script in 
production).

However, you want to make sure that `bower.json` of the new dep points to the 
non-minified version of the lib you're adding. If that's not the case, update 
this project's [`bower.json`][bower.json] and add a section to the `overrides`
with `main` pointing to the non-minified version (there already are a bunch).


## Configuration

For now, the web application assumes that the API sits on the same host. It 
would be entirely possible to access an API from a different server by 
introducing a set of configuration parameters. However, the only config the 
web application receives for now is the name of the authorization header.

In order to pass this value to the Angular app, we have an `authHeader` 
directive that sits in the DOM and gets set by the template engine, which 
receives the parameter from `settings.js`. Should we need additional 
parameters in the future, this directive will probably become more generic.


## Deployment

Deployment basically means copying the files generated by `grunt build` to the 
webroot of a static web server. However, there is one subtlety about 
`index.html` that needs special treatment: Since Angular takes care of loading 
the correct view depending on the URL, the webserver must return the same 
`index.html` for all URLs of the site.

In our case, that means if the request points to a directory, always return 
`index.html`. In Nginx, this is easily configurable:

	# map directories to index
	location ~ \/[^\.]*$ {
		root $build_directory/html;
		try_files /index.html =404;
		add_header Cache-Control public;
	}

Note that when running locally, you don't need to bother setting up a 
webserver because Node.js does the file serving automatically itself when 
running with `grunt dev`.


[angular]: https://angularjs.org/
[bower]: http://bower.io/
[bower.json]: https://github.com/freezy/node-vpdb/blob/master/bower.json
[ngModule]: https://docs.angularjs.org/guide/module
[index.jade]: https://github.com/freezy/node-vpdb/blob/master/client/app/index.jade