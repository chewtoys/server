---
title: Web Application
layout: page.pug
menuIndex: 1
subsectionIndex: 3
---

# Overview

The web application runs with AngularJS, which takes care of loading as well
as rendering dynamic content. It also handles routing and templating. This 
means that on server side, we deliver 100% statically compiled HTML and
Javascript code and retrieve dynamic data exclusively through the API.


## Code Structure

Code in the web app is organized by feature. A feature is typically a page,
but we also have a "commons" feature and a feature for the entire developer
site you're reading now.

In Angular terms, a feature corresponds to a [module][ngModule] and has its
own sub-folder within the `client/app` directory. Since templates and
Javascript code are wired very closely together, we keep the templates in the
module folder as well.


## Templating

There is only one HTML file that isn't loaded dynamically, `index.html`. It
gets rendered through [`client/app/index.pug`][index.pug] and is returned by
the web server for any folder requests, i.e. requests that point to a
directory rather than a file name.

All other views are so-called *partials* and are dynamically loaded and
inserted into the DOM by Angular's routing module.


## Dependencies

We use [Bower][bower] for managing client-side dependencies. That means that
generally, if you need a new dependency, all you have to do is:

	bower install <dependency> --save
	grunt build

And you're done (as in: dependency is downloaded, script is added to the DOM
when developing and added to the global concatenated and minified script in
production).

However, you want to make sure that `bower.json` of the new dep points to the
non-minified version of the lib you're adding. If that's not the case, update
this project's [`bower.json`][bower.json] and add a section to the `overrides`
with `main` pointing to the non-minified version (there already are a bunch).


## Configuration

Although the webapp is pretty much decoupled from the server, it still needs
to know where to connect to when accessing the API. For this reason, a config
file is built on server side that is included by the client. It contains an
object with the following properties:

 * `authHeader` - The name of the API's authorization header. Setting it to
   something different than `Authorization` allows protecting the whole API
   with let's say HTTP basic authentication.
 * `apiUri` - An object containing `host`, `port`, `scheme`, `path` and
   `storagePath` which point to the API.
 * `webUri` - An object containing `host`, `port`, `scheme` pointing to the web
   application (i.e. to itself).
 * `authProviders` - Defines the third party OAuth providers that are allowed.

The config object is retrieved as a constant in Angular and can be injected
with the name `Config` where needed. If you want to debug it, type `vpdbConfig`
in the devtools console.

Note that keeping host and port configurable allows you to test the webapp
locally while connecting to the production API, which can be useful.


## Deployment

Deployment basically means copying the files generated by `grunt build` to the
webroot of a static web server. However, there is one subtlety about
`index.html` that needs special treatment: Since Angular takes care of loading
the correct view depending on the URL, the webserver must return the same
`index.html` for all URLs of the site.

In our case, that means if the request points to a directory, always return
`index.html`. In Nginx, this is easily configurable:

	# map directories to index
	location ~ \/[^\.]*$ {
		root $build_directory/html;
		try_files /index.html =404;
		add_header Cache-Control public;
	}

Note that when running locally, you don't need to bother setting up a
webserver because Node.js does the file serving automatically itself when
running with `grunt dev`.


[angular]: https://angularjs.org/
[bower]: http://bower.io/
[bower.json]: https://github.com/vpdb/backend/blob/master/bower.json
[ngModule]: https://docs.angularjs.org/guide/module
[index.pug]: https://github.com/vpdb/backend/blob/master/client/app/index.pug
